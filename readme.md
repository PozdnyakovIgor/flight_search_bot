<h1 align="center">Telegram-bot AVIASALES_API_BOT

[![Telegram URL](https://www.dampftbeidir.de/mediafiles/tpl/icon-telegram.png)](https://t.me/EASY_BREEZE_BOT) 
</h1>

***

## Краткое описание

[Телеграмм бот](https://gitlab.skillbox.ru/igor_pozdniakov/python_basic_diploma) позволяет найти дешевые авиабилеты на платформе [aviasales.ru](https://www.aviasales.ru/). <br>
Все данные передаются из кеша, который формируется на основании поисков пользователей сайтов Aviasales за последние 48 часов. <br> 
Пользователь с помощью специальных команд бота может выполнить следующие действия (получить следующую информацию): <br/>
- Найти авиабилеты с указанием города отправления, города прилета, даты отправления и даты возвращения (**команда /want_ticket**); 
- Найти самые дешевые авиабилеты из города с возможностью указания дат отправления/возвращения (**команда /top_cheapest_tickets**); 
- (решаю, какой функционал написать 3-ей функции);
- Узнать историю поиска билетов (**команда /history**).


**Для разработки и функционирования проекта используется открытый API travelpayouts, который расположен на сайте [travelpayouts.com](https://travelpayouts.com/).**

***

## Локальная установка
Эти инструкции помогут вам развернуть проект на локальном компьютере для разработки и тестирования.

**Перед тем, как начать:**
- Если вы не пользуетесь `Python 3`, вам нужно установить инструмент `virtualenv` при помощи `pip install virtualenv`. 
Если вы используете `Python 3`, у вас уже установлен модуль [venv](https://docs.python.org/3/library/venv.html) в стандартной библиотеке.

### Запуск проекта (на примере Manjaro Linux)
- Клонировать проект командой: git clone `https://gitlab.skillbox.ru/igor_pozdniakov/python_basic_diploma`;
- Создать файл `.env` вида:

    BOT_TOKEN= "токен вашего телеграм-бота, полученный от [@BotFather](https://t.me/BotFather) ";<br>
    RAPID_API_KEY= "ключ вашего api, полученный от [travelpayouts.com](https://travelpayouts.com/) ".<br>
<br>
- Установить виртуальное окружение командой: <b>python -m venv venv;</b><br>
- Активировать виртуальное окружение командой: <b>source venv/bin/activate;</b><br>
- Установить необходимые зависимости командой: <b>pip install -r requirements.txt;</b><br>
- Запустите бота командой: <b>python main.py</b><br>


### Запуск проекта (на примере Windows)

- Создайте на своем компьютере папку проекта;
- Склонируйте этот репозиторий в папку проекта `https://gitlab.skillbox.ru/igor_pozdniakov/python_basic_diploma`;
- Создайте файл `.env` и добавьте в него переменные окружения, следующего вида:
<br>
    BOT_TOKEN= "токен вашего телеграм-бота, полученный от [@BotFather](https://t.me/BotFather) ";<br>
    RAPID_API_KEY= "ключ вашего api, полученный от [travelpayouts.com](https://travelpayouts.com/) ".<br>
<br>
- Активируйте виртуальное окружение `pipenv shell`;
- Установите все зависимости `pipenv install --ignore-Pipfile`;
- Запустите бота командой `pipenv run main.py` из Терминала из папки с проектом.

***

## Описание работы команд

### Команда /start

После ввода команды: 
1. Выводится приветствие пользователю.

### Команда /help

После ввода команды: 
1. Выводится список всех команд с кратким описанием.


### Команда /want_ticket

После ввода команды у пользователя запрашивается: 
1. Город отправления;
2. Город назначения;
3. Дата отправления (в формате YYYY-MM или YYYY-MM-DD);
4. Дата возвращения (в формате YYYY-MM или YYYY-MM-DD);
5. Количество вариантов, которое необходимо вывести (не более заранее определенного максимума).


### Команда /top_cheapest_tickets

После ввода команды у пользователя запрашивается: 
1. Город отправления;
2. Хочет ли он указать дату вылета (появляется инлайн-клавиатура с кнопками "Да/Нет"). При положительном ответе пользователь вводит дату отправления (в формате YYYY-MM или YYYY-MM-DD);
3. Хочет ли он указать дату прилета (появляется инлайн-клавиатура с кнопками "Да/Нет"). При положительном ответе пользователь вводит дату возвращения (в формате YYYY-MM или YYYY-MM-DD);
4. Количество вариантов, которое необходимо вывести (не более заранее определенного максимума).

### Команда /popular_directions

После ввода команды у пользователя запрашивается: 
1. Город отправления;
2. Выдается список популярных городов в виде инлайн-клавиатуры, пользователь выбирает нужный;
3. Хочет ли он указать дату вылета (появляется инлайн-клавиатура с кнопками "Да/Нет"). При положительном ответе пользователь вводит дату отправления (в формате YYYY-MM или YYYY-MM-DD);
4. Хочет ли он указать дату прилета (появляется инлайн-клавиатура с кнопками "Да/Нет"). При положительном ответе пользователь вводит дату возвращения (в формате YYYY-MM или YYYY-MM-DD);
5. Количество вариантов, которое необходимо вывести (не более заранее определенного максимума).

### Команда /history

После ввода команды пользователю выводится история поиска билетов (не более 10 последних запросов), каждое сообщение содержит: 
1. Введенную пользователем команду;
2. Веденный запрос:
- город отправления;<br> 
- город назначения (если был указан);<br> 
- дата отправления (если была указана);<br> 
- дата возвращения (если была указана);<br> 
- число билетов, которое необходимо вывести.
3. Дата и время вводы команды

Под каждым сообщением находится inline-кнопка с текстом "вывести результаты поиска", при нажатии на которую пользователю выводятся найденные билеты.

## Описание внешнего вида и UI
Окно Telegram-бота при запущенном Python-скрипте воспринимает следующие команды:
- /start - запуск бота;
- /help — помощь по командам бота;
- /want_ticket — поиск билетов с конкретными датами вылета/прилета;
- /top_cheapest_tickets — поиск самых дешевых билетов из заданного города;
- /popular_directions — самые популярные направления из города;
- /history — вывод истории поиска билетов.

Для команды want_ticket, сообщение с результатом содержит следующую краткую информацию по каждому билету:

- Город отправления и его IATA-код;
- Аэропорт отправления и его IATA-код;
- Город прибытия и его IATA-код;
- Аэропорт прибытия и его IATA-код;
- Дата и время вылета из пункта отправления с указанием часового пояса;
- Дата и время обратного рейса с указанием часового пояса;
- Цена (руб.);
- Ссылка на билет.

Для команды top_cheapest_tickets, сообщение с результатом содержит следующую краткую информацию по каждому билету:
- Город отправления и его IATA-код;
- Аэропорт отправления и его IATA-код;
- Город прибытия и его IATA-код;
- Аэропорт прибытия и его IATA-код;
- Дата и время вылета из пункта отправления с указанием часового пояса;
- Дата и время обратного рейса с указанием часового пояса (если пользователь подтвердил необходимость обратного билета);
- Цена (руб.);
- Ссылка на билет в виде URL-кнопки.

Для команды popular_directions, сообщение с результатом содержит следующую краткую информацию по каждому билету:
- Город отправления и его IATA-код;
- Аэропорт отправления и его IATA-код;
- Город прибытия и его IATA-код;
- Аэропорт прибытия и его IATA-код;
- Дата и время вылета из пункта отправления с указанием часового пояса;
- Дата и время обратного рейса с указанием часового пояса (если пользователь подтвердил необходимость обратного билета);
- Цена (руб.);
- Ссылка на билет в виде URL-кнопки.

Для команды history, сообщение с результатом содержит следующую краткую информацию по каждому билету:
- Город отправления и его IATA-код;
- Аэропорт отправления и его IATA-код;
- Город прибытия и его IATA-код;
- Аэропорт прибытия и его IATA-код;
- Дата и время вылета из пункта отправления с указанием часового пояса;
- Дата и время обратного рейса с указанием часового пояса (если пользователь подтвердил необходимость обратного билета);
- Цена (руб.);
- Ссылка на билет в виде URL-кнопки.

## В разработке использованы

attrs==22.2.0<br>
Babel==2.9.1<br>
certifi==2022.12.7<br>
black==23.7.0<br>
charset-normalizer==3.1.0<br>
frozenlist==1.3.3<br>
idna==3.4<br>
colorama==0.4.6<br>
click==8.1.7<br>
magic-filter==1.0.9<br>
multidict==6.0.4<br>
mypy-extensions==1.0.0<br>
packaging==23.1<br>
pathspec==0.11.2<br>
platformdirs==3.10.0<br>
peewee==3.16.0<br>
pystun3==1.0.0<br>
pyTelegramBotAPI==4.12.0<br>
python-dateutil==2.8.2<br>
python-dotenv==1.0.0<br>
pytz==2023.2<br>
requests==2.31.0<br>
six==1.16.0<br>
telebot==0.0.5<br>
travelpayouts==1.1.0<br>
urllib3==1.26.15<br>
yarl==1.8.2<br>
